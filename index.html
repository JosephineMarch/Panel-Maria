<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel María - Organizador Personal</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
    <link rel="icon" href="data:,">

    <link rel="manifest" href="manifest.json">

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('Service Worker registrado', reg))
        .catch(err => console.log('Error al registrar SW', err));
    });
  }

  // Lógica para capturar lo compartido
  window.addEventListener('DOMContentLoaded', () => {
    const parsedUrl = new URL(window.location);
    const sharedTitle = parsedUrl.searchParams.get('title');
    const sharedText = parsedUrl.searchParams.get('text');
    const sharedUrl = parsedUrl.searchParams.get('url');

    if (sharedTitle || sharedText || sharedUrl) {
      // Aquí es donde tu app recibe la info. 
      // Puedes hacer un alert o llamar a tu función de Firebase para guardar
      console.log("Recibido para guardar:", { sharedTitle, sharedText, sharedUrl });
      alert("¡Recibido! Guardando: " + (sharedTitle || sharedUrl));
      
      // Ejemplo: si tienes una función guardarEnFirebase(data), la llamarías aquí
    }
  });
</script>
    
</head>
<body>
    <!-- App Bar -->
    <header class="app-bar">
        <div class="container">
            <div class="app-bar__inner">
                <div class="app-bar__title-group">
                    <div class="app-bar__icon-wrapper">
                        <span class="material-symbols-outlined">dashboard</span>
                    </div>
                    <div>
                        <h1 class="app-bar__title">Panel María</h1>
                        <p class="app-bar__subtitle">Organiza tus recursos, ideas, proyectos y logros</p>
                    </div>
                </div>
                <div class="app-bar__actions">
                    <button id="settingsBtn" class="btn btn--text">
                        <span class="material-symbols-outlined">settings</span>
                    </button>
                    <button id="addItemBtn" class="btn btn--filled hidden">
                        <span class="material-symbols-outlined">add</span> Nuevo
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Auth Section -->
    <div id="auth-section" class="auth-section">
        <div class="auth-card">
            <h2>Bienvenido a Panel María</h2>
            <p>Inicia sesión con Google para sincronizar tus datos en la nube, o continúa de forma local.</p>
            <button id="loginBtn" class="btn btn--filled">
                <span class="material-symbols-outlined">login</span> Iniciar sesión con Google
            </button>
        </div>
    </div>

    <!-- Main App Content -->
    <div id="app-content" class="hidden">
        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <div class="container">
                <div class="nav-tabs__inner">
                    <!-- Las pestañas se generan dinámicamente -->
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="container">
            <!-- Search and Filters -->
            <div class="filters-bar">
                <div class="search-wrapper">
                    <span class="material-symbols-outlined search-icon">search</span>
                    <input type="text" id="searchInput" placeholder="Buscar..." class="input-field">
                </div>
                <div id="tagFilters" class="tag-filters"></div>
                <div class="sort-wrapper">
                    <label for="sortSelect" class="form-label">Ordenar por:</label>
                    <select id="sortSelect" class="input-field">
                        <option value="recientes">Más recientes</option>
                        <option value="antiguos">Más antiguos</option>
                        <option value="titulo-asc">Título (A-Z)</option>
                        <option value="titulo-desc">Título (Z-A)</option>
                    </select>
                </div>
            </div>

            <!-- Bulk Actions Bar -->
            <div id="bulkActions" class="bulk-actions-bar hidden">
                <div class="selection-controls">
                    <input type="checkbox" id="selectAllCheckbox" class="checkbox-field">
                    <label for="selectAllCheckbox">Seleccionar todo</label>
                    <span id="selectionCount" class="selection-count">0</span>
                </div>
                <div class="actions">
                    <button id="bulkChangeCategoryBtn" class="btn btn--secondary">Cambiar Categoría</button>
                    <button id="bulkChangeTagsBtn" class="btn btn--secondary">Cambiar Etiquetas</button>
                    <button id="bulkPinBtn" class="btn btn--secondary">Anclar/Desanclar</button>
                    <button id="bulkDeleteBtn" class="btn btn--danger">Eliminar</button>
                </div>
            </div>

            <!-- Items Grid -->
            <div id="itemsContainer" class="items-grid">
                <!-- Tarjetas de items se inyectan aquí -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state hidden">
                <span class="material-symbols-outlined empty-state__icon">add_circle</span>
                <h3 class="empty-state__title">No hay elementos en esta categoría</h3>
                <p class="empty-state__text">Comienza agregando tu primer elemento.</p>
                <button id="emptyStateAddBtn" class="btn btn--filled">
                    <span class="material-symbols-outlined">add</span>
                    Agregar Primer Elemento
                </button>
            </div>
        </main>
    </div>

    <!-- Modal for Add/Edit Item -->
    <div id="itemModal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal__header">
                <h2 id="modalTitle" class="modal__title">Agregar Nuevo Elemento</h2>
                <button id="closeModalBtn" class="btn btn--icon"><span class="material-symbols-outlined">close</span></button>
            </div>
            <form id="itemForm" class="modal__body">
                <div class="form-group">
                    <label for="itemCategory" class="form-label">Categoría *</label>
                    <select id="itemCategory" required class="input-field"></select>
                </div>
                <div class="form-group" id="newCategoryInputGroup" style="display: none;">
                    <label for="newItemCategory" class="form-label">Nombre de la nueva categoría *</label>
                    <input type="text" id="newItemCategory" class="input-field" placeholder="Ej: Recetas, Viajes">
                </div>
                <div class="form-group">
                    <label for="itemTitle" class="form-label">Título *</label>
                    <input type="text" id="itemTitle" required class="input-field" placeholder="Título del elemento">
                </div>
                <div class="form-group">
                    <label for="itemDescription" class="form-label">Descripción</label>
                    <textarea id="itemDescription" rows="3" class="input-field" placeholder="Descripción opcional"></textarea>
                </div>
                <div class="form-group">
                    <label for="itemUrl" class="form-label">URL</label>
                    <input type="url" id="itemUrl" class="input-field" placeholder="https://ejemplo.com">
                </div>
                <div class="form-group">
                    <label for="itemTagsInput" class="form-label">Etiquetas</label>
                    <div id="itemTagsWrapper" class="tags-input-wrapper">
                        <input type="text" id="itemTagsInput" class="tags-input-field" placeholder="Añade o crea etiquetas...">
                    </div>
                    <div id="tagSuggestions" class="tag-suggestions"></div>
                </div>
                <div id="tasksSection" class="form-group">
                    <label class="form-label">Tareas</label>
                    <div id="tasksList" class="tasks-list"></div>
                    <button type="button" id="addTaskBtn" class="btn btn--text"><span class="material-symbols-outlined">add</span> Agregar Tarea</button>
                </div>
                <div class="form-group-inline">
                    <input type="checkbox" id="itemPinned" class="checkbox-field">
                    <label for="itemPinned">Anclar este elemento</label>
                </div>
                <div class="modal__footer">
                    <button type="button" id="cancelBtn" class="btn btn--text">Cancelar</button>
                    <button type="submit" id="saveBtn" class="btn btn--filled">Guardar</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modals (Bulk, Confirm, Settings, etc.) -->
    <div id="bulkCategoryModal" class="modal-overlay hidden"><div class="modal"><div class="modal__header"><h2 class="modal__title">Cambiar Categoría en Lote</h2><button id="bulkCategoryCancelBtn" class="btn btn--icon"><span class="material-symbols-outlined">close</span></button></div><div class="modal__body"><p class="modal__text">Selecciona la nueva categoría.</p><select id="bulkCategorySelector" class="input-field"></select></div><div class="modal__footer"><button type="button" id="bulkCategoryOkBtn" class="btn btn--filled">Aplicar</button></div></div></div>
    <div id="bulkTagsModal" class="modal-overlay hidden"><div class="modal"><div class="modal__header"><h2 class="modal__title">Cambiar Etiquetas en Lote</h2><button id="bulkTagsCancelBtn" class="btn btn--icon"><span class="material-symbols-outlined">close</span></button></div><div class="modal__body"><p class="modal__text">Establece las nuevas etiquetas para los elementos seleccionados.</p><div id="bulkTagsWrapper" class="tags-input-wrapper"><input type="text" id="bulkTagsInput" class="tags-input-field" placeholder="Añade etiquetas..."></div><div id="bulkTagSuggestions" class="tag-suggestions"></div></div><div class="modal__footer"><button type="button" id="bulkTagsOkBtn" class="btn btn--filled">Aplicar</button></div></div></div>
    <div id="confirmModal" class="modal-overlay hidden"><div class="modal modal--confirm"><div class="modal__body"><h3 id="confirmTitle" class="modal__title">Confirmar</h3><p id="confirmMessage" class="modal__confirm-text">¿Estás seguro?</p><div class="modal__footer"><button id="confirmCancelBtn" class="btn btn--text">Cancelar</button><button id="confirmOkBtn" class="btn btn--danger">Confirmar</button></div></div></div></div>
    <div id="settingsModal" class="modal-overlay hidden"><div class="modal"><div class="modal__header"><h2 class="modal__title">Configuración</h2><button id="settingsCloseBtn" class="btn btn--icon"><span class="material-symbols-outlined">close</span></button></div><div class="modal__body"><div class="form-group-inline"><input type="checkbox" id="autoSaveVoice" class="checkbox-field"><label for="autoSaveVoice">Guardado automático por voz</label></div><div class="form-group"><label for="themeSelect" class="form-label">Tema</label><select id="themeSelect" class="input-field"><option value="default">Por defecto</option><option value="dark">Oscuro</option><option value="colorful">Colorido</option></select></div>                <div class="form-group"><button id="exportDataBtn" class="btn btn--secondary">Exportar Datos</button><button id="importDataBtn" class="btn btn--secondary">Importar Datos</button><input type="file" id="importFile" accept=".json,.html" class="hidden"></div>
                <div class="form-group">
                    <label class="form-label">Gestionar Categorías Personalizadas</label>
                    <div id="customCategoriesList"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Gestionar Etiquetas Globales</label>
                    <div id="globalTagsList"></div>
                </div>
                <div class="form-group">
                    <button id="logoutBtn" class="btn btn--text">
                        <span class="material-symbols-outlined">logout</span> Salir
                    </button>
                </div></div></div></div></div></div></div>
    <div id="newCategoryModal" class="modal-overlay hidden"><div class="modal modal--confirm"><div class="modal__header"><h2 class="modal__title">Crear Nueva Categoría</h2><button id="newCategoryCloseBtn" class="btn btn--icon"><span class="material-symbols-outlined">close</span></button></div><div class="modal__body"><div class="form-group"><label for="newCategoryNameInput" class="form-label">Nombre de la categoría</label><input type="text" id="newCategoryNameInput" class="input-field" placeholder="Ej: Trabajo, Personal"></div></div><div class="modal__footer"><button type="button" id="newCategoryCancelBtn" class="btn btn--text">Cancelar</button><button type="button" id="newCategoryCreateBtn" class="btn btn--filled">Crear</button></div></div></div>

    <!-- Chat: Botón Flotante y Ventana -->
    <button id="chat-fab" class="fab"><span class="material-symbols-outlined">smart_toy</span></button>
    <div id="chat-container" class="chat-container hidden">
        <div class="chat-header">
            <h3>Asistente IA</h3>
            <div class="chat-header-actions">
                <button id="chat-minimize" class="btn btn--icon" title="Minimizar"><span class="material-symbols-outlined">expand_more</span></button>
                <button id="chat-close" class="btn btn--icon" title="Cerrar"><span class="material-symbols-outlined">close</span></button>
            </div>
        </div>
        <div id="chat-messages" class="chat-messages"></div>
        <form id="chat-form" class="chat-input-area">
            <textarea id="chat-input" placeholder="Escribe un comando o pregunta..." rows="1"></textarea>
            <button type="submit" class="btn btn--icon"><span class="material-symbols-outlined">send</span></button>
        </form>
    </div>

    <!-- Loading Spinner -->
    <div id="loader" class="loader-overlay hidden">
        <div class="loader-spinner"></div>
    </div>

    <!-- Toast & Context Menu -->
    <div id="toastContainer" class="toast-container"></div>
    <div id="contextMenu" class="context-menu hidden"><ul><li id="contextMenuDelete">Eliminar</li></ul></div>
    
    <!-- Scripts -->
    <script src="storage.js" type="module"></script>
    <script src="auth.js" type="module"></script>
    <script src="chat.js" type="module"></script>
    <script src="app.js" type="module"></script>
</body>
</html>
