<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAI - Tu Segundo Cerebro</title>
    <meta name="description" content="PWA ADHD-Friendly para organizar tu vida">
    <meta name="theme-color" content="#FFB7C5">

    <!-- iOS support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="KAI">
    <link rel="apple-touch-icon" href="src/assets/icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="src/assets/icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="src/assets/icon-512.png">
    <link rel="apple-touch-startup-image" href="src/assets/icon-512.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <link rel="stylesheet" href="src/css/style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="src/assets/icon-192.png">

    <!-- Google Fonts: Poppins & Patrick Hand (Handwritten) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Patrick+Hand&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                        hand: ['Patrick Hand', 'cursive'],
                    },
                    colors: {
                        'cream': '#FFFDF5',
                        'sugar-pink': '#FFB7C5',
                        'hot-pink': '#FF69B4',
                        'soft-blue': '#AEC6CF',
                        'mint': '#B9FBC0',
                        'lavender': '#E6E6FA',
                        'lemon': '#FDFD96',
                        'peach': '#FFDAC1',
                        'ink': '#4A4A4A',
                        'brand': '#FFB7C5',
                        'brand-dark': '#FF9EAA',
                        'action': '#AEC6CF',
                        'success': '#B9FBC0',
                        'warning': '#FDFD96',
                        'urgent': '#FFDAC1',
                        'accent': '#E6E6FA',
                        'card-bg': '#FFFFFF',
                        'input-bg': '#F3F4F6',
                    },
                    borderRadius: {
                        'blob': '2rem',
                    },
                    boxShadow: {
                        'bubble': '0 4px 0px 0px rgba(0,0,0,0.05)',
                        'sticker': '0 6px 0px 0px rgba(0,0,0,0.08)',
                        'sticker-hover': '0 8px 0px 0px rgba(0,0,0,0.08)',
                        'pressed': 'inset 0 4px 6px rgba(0,0,0,0.1)',
                        'float': '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)',
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-slow': 'bounce 3s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-white font-sans text-ink min-h-screen flex flex-col selection:bg-sugar-pink selection:text-white">

    <!-- Left Sidebar (Like WhatsApp/Telegram) -->
    <aside id="sidebar"
        class="fixed top-0 left-0 w-80 max-w-[85vw] h-full bg-white shadow-float z-[70] transform -translate-x-full transition-transform duration-300 overflow-hidden pt-20"
        role="navigation" aria-label="Men√∫ de navegaci√≥n">
        <div class="p-4 border-b border-gray-100 flex justify-between items-center absolute top-0 left-0 right-0">
            <h2 class="text-lg font-bold">Men√∫</h2>
            <button id="btn-close-sidebar"
                class="w-12 h-12 rounded-full hover:bg-gray-100 flex items-center justify-center transition focus:outline-none focus:ring-2 focus:ring-brand cursor-pointer"
                aria-label="Cerrar men√∫">
                <i class="fa-solid fa-xmark" aria-hidden="true"></i>
            </button>
        </div>

        <!-- User Section -->
        <div class="p-4 border-b border-gray-100">
            <div id="auth-form" class="text-center py-4">
                <p class="mb-4 font-bold text-gray-600 text-sm">¬°Conecta tu cerebro!</p>
                <button type="button" id="btn-google"
                    class="w-full bg-white border-2 border-brand text-brand font-bold py-3 px-4 rounded-2xl shadow-sticker hover:bg-brand hover:text-white transition-all flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2 cursor-pointer">
                    <span aria-hidden="true">üåê</span> Google Login
                </button>
            </div>
            <div id="user-info" class="hidden flex items-center gap-3">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix&backgroundColor=ffdfbf"
                    alt="Avatar del usuario" class="w-12 h-12 rounded-full bg-peach/20 border-2 border-brand">
                <div class="flex-1 min-w-0">
                    <p class="font-bold text-sm truncate text-gray-700" id="user-email">Usuario</p>
                    <p class="text-xs text-green-600">‚óè En l√≠nea</p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="p-4 space-y-2" role="navigation" aria-label="Opciones del men√∫">
            <button id="btn-logout"
                class="hidden w-full text-left px-4 py-3 rounded-xl hover:bg-red-50 text-red-500 flex items-center gap-3 transition focus:outline-none focus:ring-2 focus:ring-red-400 cursor-pointer">
                <i class="fa-solid fa-sign-out-alt" aria-hidden="true"></i>
                <span class="font-bold text-sm">Cerrar sesi√≥n</span>
            </button>

            <div id="demo-controls" class="hidden pt-4 border-t border-gray-100">
                <button type="button" id="btn-regenerate-demo"
                    class="w-full bg-lemon text-ink font-bold py-3 px-4 rounded-2xl shadow-sticker hover:brightness-95 transition-all flex items-center justify-center gap-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand cursor-pointer">
                    <span aria-hidden="true">üîÑ</span> Regenerar Demo
                </button>
            </div>
        </nav>
    </aside>

    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/20 z-[65] hidden transition-opacity" role="presentation"
        aria-hidden="true"></div>

    <!-- HEADER -->
    <header class="bg-white z-[60] border-b border-gray-100 sticky top-0" role="banner">
        <!-- Top: Title + User -->
        <div class="flex items-center justify-between px-4 py-3">
            <div id="btn-user"
                class="w-10 h-10 rounded-full border-2 border-brand cursor-pointer focus:outline-none focus:ring-2 focus:ring-brand"
                role="button" tabindex="0" aria-label="Perfil de usuario">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix&backgroundColor=ffdfbf" alt="Tu avatar"
                    class="w-full h-full rounded-full">
            </div>
            <h1 class="font-bold text-xl text-ink" role="heading" aria-level="1">KAI</h1>
            <div class="w-10"></div>
        </div>

        <!-- Bottom: Category Icons (Full Width) -->
        <nav class="flex px-3 pb-3 gap-1 md:gap-2" role="navigation" aria-label="Filtrar por tipo">
            <button
                class="btn-category flex-1 min-h-[48px] py-3 rounded-xl text-xl font-medium transition-all text-brand hover:bg-brand hover:text-white focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2 cursor-pointer"
                data-category="all" aria-label="Ver todos">
                <i class="fa-solid fa-layer-group" aria-hidden="true"></i>
            </button>
            <button
                class="btn-category flex-1 min-h-[48px] py-3 rounded-xl text-xl font-medium transition-all text-brand hover:bg-brand hover:text-white focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2 cursor-pointer"
                data-category="nota" aria-label="Filtrar notas">
                <i class="fa-regular fa-note-sticky" aria-hidden="true"></i>
            </button>
            <button
                class="btn-category flex-1 min-h-[48px] py-3 rounded-xl text-xl font-medium transition-all text-brand hover:bg-brand hover:text-white focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2 cursor-pointer"
                data-category="tarea" aria-label="Filtrar tareas">
                <i class="fa-regular fa-circle-check" aria-hidden="true"></i>
            </button>
            <button
                class="btn-category flex-1 min-h-[48px] py-3 rounded-xl text-xl font-medium transition-all text-brand hover:bg-brand hover:text-white focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2 cursor-pointer"
                data-category="proyecto" aria-label="Filtrar proyectos">
                <i class="fa-regular fa-folder" aria-hidden="true"></i>
            </button>
            <button
                class="btn-category flex-1 min-h-[48px] py-3 rounded-xl text-xl font-medium transition-all text-brand hover:bg-brand hover:text-white focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-2 cursor-pointer"
                data-category="directorio" aria-label="Filtrar enlaces">
                <i class="fa-solid fa-link" aria-hidden="true"></i>
            </button>
        </nav>
    </header>

    <main id="app" class="flex-1 max-w-5xl mx-auto w-full px-3 py-4 md:px-8 space-y-6 pb-24 md:pb-32 no-scrollbar"
        role="main">
        <!-- Filtros de Etiquetas (Tags) - Horizontal Scroll -->
        <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0 md:flex-wrap md:overflow-visible"
            role="group" aria-label="Filtrar por etiqueta">
            <button
                class="btn-tag flex-shrink-0 px-4 py-2 min-h-[44px] rounded-full text-sm font-semibold bg-gray-100 text-gray-600 border border-gray-200 hover:border-brand hover:text-brand hover:bg-brand/5 transition-all focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-1 cursor-pointer"
                data-tag="logro" aria-label="Filtrar por logro">logro</button>
            <button
                class="btn-tag flex-shrink-0 px-4 py-2 min-h-[44px] rounded-full text-sm font-semibold bg-gray-100 text-gray-600 border border-gray-200 hover:border-brand hover:text-brand hover:bg-brand/5 transition-all focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-1 cursor-pointer"
                data-tag="salud" aria-label="Filtrar por salud">salud</button>
            <button
                class="btn-tag flex-shrink-0 px-4 py-2 min-h-[44px] rounded-full text-sm font-semibold bg-gray-100 text-gray-600 border border-gray-200 hover:border-brand hover:text-brand hover:bg-brand/5 transition-all focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-1 cursor-pointer"
                data-tag="emocion" aria-label="Filtrar por emoci√≥n">emocion</button>
            <button
                class="btn-tag flex-shrink-0 px-4 py-2 min-h-[44px] rounded-full text-sm font-semibold bg-gray-100 text-gray-600 border border-gray-200 hover:border-brand hover:text-brand hover:bg-brand/5 transition-all focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-1 cursor-pointer"
                data-tag="alarma" aria-label="Filtrar por alarma">alarma</button>
        </div>


        <!-- Layout de Feed √önico (Enesima Style) -->
        <section id="items-container" class="max-w-2xl mx-auto flex flex-col gap-8 pb-10">
            <!-- Los items se inyectar√°n aqu√≠ uno debajo de otro -->
        </section>
        </div>

        <!-- FOOTER / BARRA DE CAPTURA PRO -->
        <footer
            class="fixed bottom-0 left-0 right-0 px-2 py-3 bg-white border-t border-gray-100 z-40">
            <div
                class="bg-white border-2 border-gray-100 px-3 py-2 rounded-[2rem] shadow-lg flex items-center gap-2 max-w-full mx-auto">
                <input type="text" id="item-input" placeholder="¬øQu√© tienes en mente?"
                    class="flex-1 bg-gray-50 text-ink py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand rounded-lg placeholder-gray-400 min-w-0"
                    aria-label="Escribe tu nota o tarea">

                <div class="flex items-center gap-1">
                    <button id="btn-submit" aria-label="Guardar elemento"
                        class="w-10 h-10 rounded-full bg-brand text-white flex items-center justify-center shrink-0 shadow-md active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-brand focus:ring-offset-1 cursor-pointer">
                        <i class="fa-solid fa-plus text-sm" aria-hidden="true"></i>
                    </button>

                    <!-- Bot√≥n Micr√≥fono -->
                    <button id="btn-voice-footer" aria-label="Grabar nota de voz"
                        class="w-10 h-10 rounded-full bg-brand text-white flex items-center justify-center shrink-0 shadow-md hover:scale-105 active:scale-95 transition border-2 border-white focus:outline-none focus:ring-2 focus:ring-brand cursor-pointer">
                        <i class="fa-solid fa-microphone text-sm" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </footer>

        <!-- El Asistente Kai (Floating Widget con Chat) -->
        <!-- Kai Chat Full Screen -->
        <div id="kai-chat-overlay" class="fixed inset-0 bg-white z-[100] hidden flex flex-col">
            <!-- Chat Header -->
            <div class="bg-brand px-4 py-3 text-white flex items-center justify-between shrink-0">
                <div class="flex items-center gap-3">
                    <button id="kai-chat-back"
                        class="w-9 h-9 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition">
                        <i class="fa-solid fa-arrow-left text-sm"></i>
                    </button>
                    <div class="flex items-center gap-2">
                        <img src="icon.svg" class="w-7 h-7 rounded-full bg-white" alt="KAI">
                        <span class="font-bold text-sm">Kai</span>
                    </div>
                </div>
                <button id="kai-chat-minimize"
                    class="w-9 h-9 rounded-full hover:bg-white/20 flex items-center justify-center transition">
                    <i class="fa-solid fa-xmark text-sm"></i>
                </button>
            </div>

            <!-- Chat Messages -->
            <div id="kai-chat-messages" class="flex-1 overflow-y-auto p-3 space-y-2 bg-cream">
                <div class="bg-white p-3 rounded-2xl rounded-bl-none shadow-sm max-w-[85%]">
                    <p class="text-sm text-ink">¬°Hola Maria! ‚ú® Soy Kai. Estoy listo para ayudarte. ¬øQu√© tienes en mente?
                    </p>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="p-3 bg-white border-t border-gray-100 shrink-0">
                <div class="flex gap-2 items-center">
                    <input type="text" id="kai-chat-input" placeholder="Escribe..."
                        class="flex-1 bg-gray-100 border-none rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-brand outline-none">
                    <button id="kai-chat-send"
                        class="w-9 h-9 rounded-full bg-brand text-white flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-paper-plane text-xs"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Kai Avatar (Floating Trigger) -->
        <div id="kai-widget" class="fixed bottom-20 md:bottom-6 right-4 z-50" role="complementary"
            aria-label="Asistente Kai">
            <div id="kai-avatar-container" class="cursor-pointer relative" role="button" tabindex="0"
                aria-label="Abrir asistente Kai">
                <div
                    class="w-14 h-14 md:w-16 md:h-16 bg-white rounded-full shadow-lg flex items-center justify-center hover:scale-105 active:scale-95 overflow-hidden border-4 border-brand focus:outline-none focus:ring-2 focus:ring-brand">
                    <img src="icon.svg" class="w-full h-full object-cover" id="kai-avatar" alt="Kai">
                </div>
                <div id="kai-status"
                    class="absolute bottom-0 right-0 w-3 h-3 md:w-4 md:h-4 bg-green-400 border-2 border-white rounded-full"
                    aria-label="Estado: en l√≠nea"></div>
            </div>
        </div>

        <!-- Reutilizamos el modal de edici√≥n con clases Tailwind -->
        <div id="modal-edit"
            class="fixed inset-0 bg-ink/20 backdrop-blur-sm z-[100] flex items-center justify-center hidden p-4"
            role="dialog" aria-modal="true" aria-labelledby="modal-title">
            <div class="bg-white w-full max-w-lg rounded-blob shadow-2xl max-h-[90vh] overflow-y-auto p-8 relative">
                <button
                    class="modal-close absolute top-6 right-6 w-12 h-12 rounded-full hover:bg-gray-100 flex items-center justify-center transition focus:outline-none focus:ring-2 focus:ring-brand cursor-pointer"
                    aria-label="Cerrar modal">
                    <i class="fa-solid fa-xmark text-xl" aria-hidden="true"></i>
                </button>
                <h3 id="modal-title" class="text-2xl font-bold mb-6 text-brand">Personalizar Bloque</h3>

                <form id="edit-form" class="space-y-6">
                    <input type="hidden" id="edit-id">

                    <div class="space-y-2">
                        <label for="edit-type" class="font-bold text-sm ml-2 flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-brand"></span>
                            Tipo
                        </label>
                        <select id="edit-type"
                            class="w-full bg-input-bg border-none rounded-blob px-4 py-3 font-bold text-ink focus:ring-2 focus:ring-brand"
                            required>
                            <option value="nota">üìù Nota</option>
                            <option value="tarea">‚úÖ Tarea</option>
                            <option value="proyecto">üìÅ Proyecto</option>
                            <option value="directorio">üîó Enlace</option>
                        </select>
                    </div>

                    <div class="space-y-2">
                        <label for="edit-content" class="font-bold text-sm ml-2">T√≠tulo</label>
                        <input type="text" id="edit-content"
                            class="w-full bg-input-bg border-none rounded-blob px-6 py-4 font-bold focus:ring-2 focus:ring-brand"
                            required>
                    </div>

                    <div id="alarm-section" class="space-y-2">
                        <label class="font-bold text-sm ml-2">‚è∞ Programar Alarma (Fecha y Hora)</label>
                        <div class="flex gap-2">
                            <input type="date" id="edit-deadline-date"
                                class="flex-1 bg-input-bg border-none rounded-blob px-4 py-3 font-bold focus:ring-2 focus:ring-brand">
                            <input type="time" id="edit-deadline-time"
                                class="flex-1 bg-input-bg border-none rounded-blob px-4 py-3 font-bold focus:ring-2 focus:ring-brand">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="font-bold text-sm ml-2">Descripci√≥n</label>
                        <textarea id="edit-description"
                            class="w-full bg-input-bg border-none rounded-blob px-6 py-4 min-h-[60px] focus:ring-2 focus:ring-brand resize-none field-sizing-content"
                            placeholder="A√±ade m√°s detalles aqu√≠..."></textarea>
                    </div>

                    <div class="space-y-2">
                        <div class="flex justify-between items-center ml-2">
                            <label class="font-bold text-sm">Tareas</label>
                            <button type="button" id="btn-add-task"
                                class="text-brand font-bold text-xs hover:underline">+ A√±adir tarea</button>
                        </div>
                        <div id="edit-tasks-container" class="space-y-2"></div>
                    </div>

                    <div class="space-y-2">
                        <label class="font-bold text-sm ml-2">Enlace Directo</label>
                        <input type="url" id="edit-url"
                            class="w-full bg-input-bg border-none rounded-blob px-6 py-4 text-action font-medium"
                            placeholder="https://...">
                    </div>

                    <div class="space-y-2">
                        <label class="font-bold text-sm ml-2 flex items-center gap-2">
                            <i class="fa-solid fa-tag text-xs text-lavender"></i>
                            Etiquetas
                            <span class="text-[10px] font-normal text-gray-400">(para an√°lisis personal)</span>
                        </label>
                        <div class="flex gap-2 mb-2 flex-wrap">
                            <span
                                class="tag-suggestion px-2 py-1 rounded-lg text-[10px] font-semibold text-brand border border-brand/30 cursor-pointer hover:border-brand hover:bg-brand/5 transition"
                                data-tag="logro">logro</span>
                            <span
                                class="tag-suggestion px-2 py-1 rounded-lg text-[10px] font-semibold text-brand border border-brand/30 cursor-pointer hover:border-brand hover:bg-brand/5 transition"
                                data-tag="salud">salud</span>
                            <span
                                class="tag-suggestion px-2 py-1 rounded-lg text-[10px] font-semibold text-brand border border-brand/30 cursor-pointer hover:border-brand hover:bg-brand/5 transition"
                                data-tag="emocion">emocion</span>
                            <span
                                class="tag-suggestion px-2 py-1 rounded-lg text-[10px] font-semibold text-brand border border-brand/30 cursor-pointer hover:border-brand hover:bg-brand/5 transition"
                                data-tag="alarma">alarma</span>
                        </div>
                        <input type="text" id="edit-tags"
                            class="w-full bg-lavender/30 border border-lavender rounded-blob px-6 py-4 text-purple-600 font-bold placeholder-gray-400"
                            placeholder="logro, salud, emocion...">
                    </div>

                    <div class="flex gap-4 pt-4">
                        <button type="submit"
                            class="flex-1 bg-brand text-white font-bold py-2 rounded-blob shadow-sticker hover:bg-brand-dark transition-all">Guardar</button>
                        <button type="button"
                            class="flex-1 bg-gray-100 text-gray-500 font-bold py-2 rounded-blob shadow-sticker hover:bg-gray-200 transition-all modal-close">Quiz√°s
                            luego</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="voice-overlay"
            class="fixed inset-0 bg-brand/90 backdrop-blur-md z-[200] flex items-center justify-center hidden">
            <div class="text-center text-white px-8">
                <div
                    class="w-32 h-32 bg-white rounded-full mx-auto mb-8 flex items-center justify-center animate-pulse shadow-float">
                    <span class="text-6xl">üé§</span>
                </div>
                <h2 class="font-bold mb-4">¬°Te escucho!</h2>
                <p id="voice-text" class="font-hand mb-10 min-h-[1.5em]"></p>
                <button id="btn-stop-voice"
                    class="bg-white text-brand font-bold px-12 py-4 rounded-blob shadow-sticker active:shadow-pressed">Ya
                    termin√©</button>
            </div>
        </div>

        <script type="module" src="app.js"></script>
</body>

</html>